# Пример использования Telegram бота

## Сценарий использования

1. **Пользователь находит бота в Telegram**
   - Ищет бота по username (например, `@naidizakupku_bot`)
   - Нажимает "Start" или отправляет первое сообщение

2. **Бот автоматически сохраняет пользователя**
   ```sql
   INSERT INTO users (telegram_id, first_name, last_name, username, created_at, updated_at, active)
   VALUES (123456789, 'Иван', 'Иванов', 'ivan_ivanov', NOW(), NOW(), true);
   ```

3. **Пользователь отправляет сообщение**
   ```
   Пользователь: Привет, бот!
   ```

4. **Бот отвечает эхо-функцией**
   ```
   Бот: Эхо: Привет, бот!
   ```

5. **Данные пользователя обновляются**
   ```sql
   UPDATE users 
   SET first_name = 'Иван', last_name = 'Иванов', username = 'ivan_ivanov', updated_at = NOW()
   WHERE telegram_id = 123456789;
   ```

## Логи приложения

```
2024-01-15 10:30:15 [http-nio-8080-exec-1] INFO  c.n.t.s.TelegramBotService - Получено сообщение от пользователя 123456789: Привет, бот!
2024-01-15 10:30:15 [http-nio-8080-exec-1] INFO  c.n.t.s.TelegramBotService - Отправлен ответ пользователю 123456789: Эхо: Привет, бот!
```

## Структура ответа

```json
{
  "chat_id": "123456789",
  "text": "Эхо: Привет, бот!",
  "parse_mode": null,
  "entities": null,
  "reply_markup": null
}
```

## Обработка ошибок

- **Неверный токен**: Приложение не запустится
- **Сетевые проблемы**: Логируются ошибки подключения к Telegram API
- **Проблемы с БД**: Логируются ошибки сохранения пользователей
- **Пустые сообщения**: Игнорируются

## Мониторинг

### Метрики
- Количество входящих сообщений
- Количество сохраненных пользователей
- Время ответа бота

### Health Check
```bash
curl http://localhost:8080/actuator/health
```

Ответ:
```json
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP"
    },
    "telegram": {
      "status": "UP"
    }
  }
}
```
